<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>勉強中</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"><script src="https://unpkg.com/wanakana"></script><script>const THEME_KEY="theme-preference",htmlEl=document.documentElement,applyTheme=e=>{e==="dark"?htmlEl.classList.add("dark"):htmlEl.classList.remove("dark"),localStorage.setItem(THEME_KEY,e)},getPreferredTheme=()=>{const e=localStorage.getItem(THEME_KEY);return e||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},currentTheme=getPreferredTheme();applyTheme(currentTheme);</script><style>audio{width:100%;margin-top:.5rem}.choukai-script-container{max-height:0;overflow:hidden;transition:max-height .5s ease-out,padding-top .5s ease-out,margin-top .5s ease-out;background-color:var(--bg-color);border-top:1px solid transparent;margin-top:0;padding-top:0}.choukai-script-container.visible{max-height:1000px;margin-top:1rem;padding-top:1rem;border-top-color:var(--border-color);transition:max-height .5s ease-in,padding-top .5s ease-in,margin-top .5s ease-in}.choukai-script-container .ql-editor{padding-top:.5rem}.ql-container.ql-snow{border:none}.ql-editor{padding:0;font-size:1rem;line-height:1.7}.ql-editor p{margin-bottom:1em}:root{--bg-color:#f5f5f4;--text-color-p:#333;--bg-header:rgba(255, 255, 255, 0.9);--border-color:#e7e5e4;--text-primary:#1c1917;--text-secondary:#78716c;--card-bg:#ffffff;--card-hover:#f5f5f4;--button-hover:#e7e5e4}.dark{--bg-color:#1c1917;--text-color-p:#e5e5e5;--bg-header:#272322;--border-color:#44403c;--text-primary:#f5f5f4;--text-secondary:#a8a29e;--card-bg:#292524;--card-hover:#3f3f46;--button-hover:#3f3f46}body{background-color:var(--bg-color);color:var(--text-primary);transition:background-color .3s ease,color .3s ease}p{color:var(--text-color-p);transition:color .3s ease}.ql-editor{color:var(--text-color-p)}.ql-editor p{color:var(--text-color-p)}.dark .ql-editor strong{color:var(--text-primary)}header{background-color:var(--bg-header);border-color:var(--border-color);transition:background-color .3s ease,border-color .3s ease}#tab-nav{border-color:var(--border-color);transition:border-color .3s ease}#chapter-title,#tab-nav button,header a{color:var(--text-secondary);transition:color .3s ease,border-color .3s ease}#tab-nav button:hover,header a:hover{color:var(--text-primary);border-color:var(--text-secondary)}#tab-nav button.border-stone-900{color:var(--text-primary);border-color:var(--text-primary)}.dark #tab-nav button.border-stone-900{border-color:var(--text-primary)}.dark .bg-white{background-color:var(--card-bg)}.dark .border-stone-100{border-color:var(--border-color)}.dark .border-stone-200{border-color:var(--border-color)}.dark .text-stone-900{color:var(--text-primary)}.dark .text-stone-800{color:var(--text-primary)}.dark .text-stone-700{color:var(--text-primary)}.dark .text-stone-600{color:var(--text-secondary)}.dark .text-stone-500{color:var(--text-secondary)}.dark .bg-stone-100{background-color:var(--bg-color)}.dark .hover\:bg-stone-50:hover{background-color:var(--card-hover)}.dark .hover\:bg-stone-100:hover{background-color:var(--button-hover)}.dark .hover\:bg-stone-200:hover{background-color:var(--button-hover)}.dark .bg-stone-900{background-color:var(--text-primary);color:var(--bg-color)}.dark .hover\:bg-stone-800:hover{background-color:var(--text-secondary);color:var(--bg-color)}.dark .focus\:ring-stone-900:focus{--tw-ring-color:var(--text-primary)}.dark .text-stone-900.focus\:ring-stone-900{color:var(--text-primary)}#romaji-toggle-btn,#theme-toggle-btn{color:var(--text-secondary);position:relative}#romaji-toggle-btn:hover,#theme-toggle-btn:hover{color:var(--text-primary);background-color:var(--button-hover)}#theme-toggle-btn i{transition:transform .3s ease,opacity .3s ease}.vocab-card-image-placeholder{background-color:var(--border-color);display:flex;align-items:center;justify-content:center;color:var(--text-secondary)}#image-modal{transition:opacity .3s ease,visibility .3s ease}#image-modal.hidden{opacity:0;visibility:hidden}#image-modal:not(.hidden){opacity:1;visibility:visible}#image-modal>div{transition:transform .3s ease;transform:scale(.95)}#image-modal:not(.hidden)>div{transform:scale(1)}#image-modal .swiper{width:100%;height:100%;max-height:80vh}#image-modal .swiper-slide{text-align:center;font-size:18px;background:0 0;display:flex;justify-content:center;align-items:center}#image-modal .swiper-slide img{display:block;width:auto;height:auto;max-width:100%;max-height:80vh;object-fit:contain;border-radius:.375rem}#image-modal .swiper-button-next,#image-modal .swiper-button-prev{color:#fff;background-color:rgba(0,0,0,.3);width:44px;height:44px;border-radius:9999px;transition:background-color .2s ease}#image-modal .swiper-button-next:hover,#image-modal .swiper-button-prev:hover{background-color:rgba(0,0,0,.5)}#image-modal .swiper-button-next::after,#image-modal .swiper-button-prev::after{font-size:20px;font-weight:700}#image-modal .swiper-pagination-bullet{background:#fff;opacity:.7}#image-modal .swiper-pagination-bullet-active{opacity:1;background:#fff}#image-modal .swiper-slide .swiper-zoom-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center}</style></head><body class="min-h-screen antialiased"><header class="border-b border-stone-200 sticky top-0 z-10 backdrop-blur-sm"><nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-5 flex justify-between items-center gap-4"><a href="/" class="text-sm font-medium transition-colors duration-200 flex items-center gap-2 group"><span class="transform group-hover:-translate-x-1 transition-transform duration-200">&larr;</span> <span>Kembali ke Daftar</span></a><div class="flex items-center gap-2 sm:gap-4"><h2 id="chapter-title" class="text-sm font-medium text-right truncate max-w-[150px] sm:max-w-md">Memuat...</h2><button id="romaji-toggle-btn" class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full transition-colors duration-200" aria-label="Toggle Romaji"><span id="romaji-toggle-icon" class="text-lg font-bold select-none">あ</span></button> <button id="theme-toggle-btn" class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full transition-colors duration-200" aria-label="Toggle dark mode"><i id="theme-icon-sun" class="fa-solid fa-sun text-xl"></i> <i id="theme-icon-moon" class="fa-solid fa-moon text-xl hidden"></i></button></div></nav></header><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-4xl"><div class="mb-8"><div class="border-b w-full overflow-x-auto" id="tab-nav"><nav class="flex gap-1 min-w-max" aria-label="Tabs"><button class_default="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap" class_active="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap" data-tab="kosakata" class="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap">Kosakata</button> <button class_default="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap" class_active="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap" data-tab="polakalimat" class="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap">Pola Kalimat</button> <button class_default="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap" class_active="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap" data-tab="quiz" class="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap">Quiz</button> <button class_default="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap" class_active="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap" data-tab="reading" class="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap">Reading</button> <button class_default="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap" class_active="px-4 py-3 text-sm font-medium border-b-2 border-stone-900 whitespace-nowrap" data-tab="listening" class="px-4 py-3 text-sm font-medium hover:border-stone-300 border-b-2 border-transparent transition-all duration-200 whitespace-nowrap">Listening</button></nav></div></div><div id="tab-content"><div id="kosakata" class="tab-pane active"><div id="vocab-content"><p class="text-sm">Memuat kosakata...</p></div></div><div id="polakalimat" class="tab-pane hidden"><div id="grammar-content" class="space-y-8"><p class="text-sm">Memuat pola kalimat...</p></div></div><div id="quiz" class="tab-pane hidden"><div id="quiz-stats" class="space-y-8"><p class="text-sm">Jika kamu sudah memahami kosakata dan pola kalimat silahkan kerjakan quiz untuk menguji pemahaan pola kalimat kamu,</p><a id="quiz-button" href="#" class="inline-flex items-center justify-center w-full sm:w-auto px-6 py-3 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Start Quiz</a></div></div><div id="reading" class="tab-pane hidden"><div id="reading-content" class="space-y-12"><p class="text-sm">Memuat latihan membaca...</p></div><div id="dokkai-results" class="hidden mt-8"></div></div><div id="listening" class="tab-pane hidden"><div id="listening-content" class="space-y-6"><p class="text-sm">Memuat latihan mendengar...</p></div></div></div></main><div id="image-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm hidden"><div class="relative p-4 bg-transparent rounded-lg shadow-xl max-w-4xl w-full mx-4"><button id="modal-close-btn" class="absolute -top-3 -right-3 w-8 h-8 bg-white dark:bg-stone-700 text-stone-900 dark:text-stone-100 rounded-full flex items-center justify-center shadow-lg focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 z-50" aria-label="Tutup modal"><i class="fa-solid fa-times"></i></button><div class="swiper modal-swiper"><div id="swiper-wrapper-modal" class="swiper-wrapper"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div><div class="swiper-pagination"></div></div></div></div><div id="welcome-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm hidden"><div class="bg-white dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto p-6 md:p-8 mx-4 scrollbar-thin scrollbar-thumb-stone-300 dark:scrollbar-thumb-stone-700 scrollbar-track-transparent"><h2 class="text-xl font-semibold text-stone-900 dark:text-stone-100 tracking-tight mb-4 text-center">Introduction</h2><div class="text-sm text-stone-600 dark:text-stone-400 leading-relaxed space-y-4"><p>Halaman ini memuat beberapa panel/tab pembelajaran berikut:</p><ul class="list-disc list-inside space-y-1"><li><b>Kosakata</b></li><li><b>Pola Kalimat</b></li><li><b>Kuis</b></li><li><b>Reading</b></li><li><b>Listening</b></li></ul><p>Disarankan untuk memulai dari tab <b>Kosakata</b> terlebih dahulu, kemudian lanjut ke <b>Pola Kalimat</b> agar lebih mudah memahami struktur bahasa.</p><p>Halaman ini dilengkapi dengan dua mode tampilan, yaitu <b>Dark Mode</b> dan <b>Light Mode</b> untuk kenyamanan belajar.</p><p>Kamu juga bisa mengaktifkan fitur <b>Show Romaji</b> di dekat pengaturan mode tampilan, untuk membantu membaca huruf hiragana.</p><p>Silakan belajar secara mandiri dan tetap semangat, ya!</p></div><button id="modal-understand-btn" class="w-full mt-6 inline-flex items-center justify-center px-6 py-3 text-sm font-medium text-white dark:text-stone-900 bg-stone-900 dark:bg-stone-100 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Hai, wakarimashita!</button></div></div><script>document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("welcome-modal"),t=document.getElementById("modal-understand-btn"),a="tutorial-lp";if(!e||!t){console.warn("Elemen modal selamat datang tidak ditemukan.");return}localStorage.getItem(a)||(e.classList.remove("hidden"),e.classList.add("flex")),t.addEventListener("click",()=>{e.classList.add("hidden"),e.classList.remove("flex");try{localStorage.setItem(a,"true")}catch(n){console.warn("Gagal menyimpan status modal ke localStorage.",n)}})});</script><script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script><script>var d=(h,w,m)=>new Promise((L,g)=>{var E=c=>{try{p(m.next(c))}catch(u){g(u)}},v=c=>{try{p(m.throw(c))}catch(u){g(u)}},p=c=>c.done?L(c.value):Promise.resolve(c.value).then(E,v);p((m=m.apply(h,w)).next())});const urlParams=new URLSearchParams(window.location.search),babId=urlParams.get("babId"),vocabContainer=document.getElementById("vocab-content"),grammarContainer=document.getElementById("grammar-content"),readingContainer=document.getElementById("reading-content"),listeningContainer=document.getElementById("listening-content"),quizStats=document.getElementById("quiz-stats"),titleEl=document.getElementById("chapter-title"),quizButton=document.getElementById("quiz-button"),modal=document.getElementById("image-modal"),modalCloseBtn=document.getElementById("modal-close-btn"),mainContent=document.querySelector("main");let modalSwiper=null;const ROMAJI_PREF_KEY="romaji-preference";if(!babId)document.body.innerHTML='<div class="text-center p-10"><h1 class="text-2xl font-bold text-red-600">Error: ID Bab tidak ditemukan.</h1><a href="/" class="text-blue-500 hover:underline">Kembali ke Home</a></div>';else{let h=function(e){const t=e.find(n=>n.id==babId);t?(titleEl.textContent=t.title,document.title=`Belajar - ${t.title}`):titleEl.textContent="Bab Tidak Ditemukan"},m=function(e){if(vocabContainer.innerHTML="",e.length===0){vocabContainer.innerHTML='<p class="text-sm">Coming soon.</p>';return}let t="",n=!1;e.forEach(s=>{if(s.item_type==="divider")n&&(t+="</div>",n=!1),t+=`
 <h2 class="js-romaji-target text-xl font-semibold text-stone-800 dark:text-stone-200 pt-6 pb-3 mb-3 border-b border-stone-200 dark:border-stone-700">
 ${s.kosakata}
 </h2>
 `;else if(s.item_type==="vocab"){n||(t+='<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">',n=!0);const i=s.image_url?`<img src="${s.image_url}" alt="${s.kosakata}" class="w-full h-32 object-cover">`:`<div class="w-full h-32 vocab-card-image-placeholder">
 <i class="fa-solid fa-image text-3xl"></i>
</div>`;t+=`
 <div class="bg-white rounded-lg shadow-sm border border-stone-200 overflow-hidden transition-all duration-200 hover:shadow-md">
 ${i}
 <div class="p-4">
 <h3 class="js-romaji-target text-lg font-semibold text-stone-900">${s.kosakata||""}</h3>
 <p class="text-sm text-stone-600 mt-1">${s.arti||""}</p>
 </div>
 </div>
 `}}),n&&(t+="</div>"),vocabContainer.innerHTML=t},g=function(e){if(grammarContainer.innerHTML="",e.length===0){grammarContainer.innerHTML='<p class="text-sm">Belum ada pola kalimat untuk bab ini.</p>';return}e.forEach(t=>{let n="";const s=Array.isArray(t.image_urls)?t.image_urls:[];if(s.length>0){n='<div class="flex flex-wrap gap-2 mb-4">';const i=JSON.stringify(s);s.forEach((a,o)=>{a&&(n+=`
 <div>
  <img src="${a}" 
 alt="Ilustrasi" 
 class="bunpou-image w-32 h-32 object-cover rounded-lg border border-stone-200 cursor-pointer transition-transform duration-200 hover:scale-[1.05]"
 data-group-images='${i}' 
 data-image-index="${o}"
  >
 </div>
 `)}),n+="</div>"}grammarContainer.innerHTML+=`
 <div class="grammar-card py-6 border-b border-stone-100 last:border-b-0">
 <h3 class="js-romaji-target text-xl font-semibold text-stone-900 mb-4 tracking-tight">${t.pattern}</h3>
 
 <div class="space-y-4">
  <div>
  <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">Penjelasan</h4>
  <div class="ql-container">
   <div class="ql-editor leading-relaxed">${t.explanation||"N/A"}</div>
  </div>
  </div>
  <div>
  <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">Contoh</h4>
  <div class="ql-container">
   <div class="js-romaji-target ql-editor leading-relaxed">${t.example||"N/A"}</div>
  </div>
  <p class="text-sm mb-3 text-stone-600 leading-relaxed dark:text-stone-400">Klik gambar untuk melihat pola kalimat</p>
       ${n} 

  </div>
 </div>
 </div>
 `})},v=function(e){if(readingContainer.innerHTML="",!e||e.length===0){readingContainer.innerHTML='<p class="text-sm">Coming soon</p>';return}let t='<form id="dokkai-form">';e.forEach((s,i)=>{t+=`
 <div class="bg-white p-6 rounded-lg border border-stone-200 mb-8">
 <h3 class="text-lg font-semibold text-stone-900 mb-4">\u8AAD\u89E3 ${i+1}</h3>
 <div class="mb-6">
  <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">Wacana</h4>
  <div class="ql-container rounded-lg">
  <div class="js-romaji-target ql-editor leading-relaxed">${s.passage_content||""}</div>
  </div>
 </div>
 <div>
  <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-4">Pertanyaan</h4>
  <div class="space-y-6">
  `,s.questions&&s.questions.length>0?s.questions.forEach((a,o)=>{t+=`
 <div class="border-t border-stone-100 pt-6 first:border-t-0 first:pt-0">
  <p class="js-romaji-target text-base font-medium text-stone-800 mb-4">${o+1}. ${a.question_text||""}</p>
  <div class="space-y-3">
  <label class="flex items-center p-3 border border-stone-200 rounded-lg hover:bg-stone-50 transition-colors cursor-pointer">
   <input type="radio" name="dokkai_q_${a.id}" value="A" class="mr-3 text-stone-900 focus:ring-stone-900" required>
   <span class="js-romaji-target text-sm text-stone-700">A. ${a.option_a||""}</span>
  </label>
  <label class="flex items-center p-3 border border-stone-200 rounded-lg hover:bg-stone-50 transition-colors cursor-pointer">
   <input type="radio" name="dokkai_q_${a.id}" value="B" class="mr-3 text-stone-900 focus:ring-stone-900" required>
   <span class="js-romaji-target text-sm text-stone-700">B. ${a.option_b||""}</span>
  </label>
  <label class="flex items-center p-3 border border-stone-200 rounded-lg hover:bg-stone-50 transition-colors cursor-pointer">
   <input type="radio" name="dokkai_q_${a.id}" value="C" class="mr-3 text-stone-900 focus:ring-stone-900" required>
   <span class="js-romaji-target text-sm text-stone-700">C. ${a.option_c||""}</span>
  </label>
  <label class="flex items-center p-3 border border-stone-200 rounded-lg hover:bg-stone-50 transition-colors cursor-pointer">
   <input type="radio" name="dokkai_q_${a.id}" value="D" class="mr-3 text-stone-900 focus:ring-stone-900" required>
   <span class="js-romaji-target text-sm text-stone-700">D. ${a.option_d||""}</span>
  </label>
  </div>
 </div>
 `}):t+='<p class="text-sm text-stone-500">Wacana ini belum memiliki pertanyaan.</p>',t+="</div></div></div>"}),e.some(s=>s.questions&&s.questions.length>0)&&(t+=`
 <button type="submit" class="inline-flex items-center justify-center w-full px-6 py-3 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">
  Kumpulkan Jawaban Dokkai
 </button>
 `),t+="</form>",readingContainer.innerHTML=t;const n=document.getElementById("dokkai-form");n&&n.addEventListener("submit",c)},u=function(e){const t=document.getElementById("dokkai-results");t.innerHTML=`
 <div class="bg-white p-6 rounded-lg border border-stone-200">
 <h3 class="text-xl font-semibold text-stone-900 mb-4">Hasil Latihan Membaca</h3>
 <p class="text-lg">Skor Anda: <span class="font-bold text-green-600">${e.score}</span> / ${e.total}</p>
 </div>
 `,t.classList.remove("hidden"),t.scrollIntoView({behavior:"smooth",block:"center"}),e.results.forEach(n=>{const s=n.questionId;document.getElementsByName(`dokkai_q_${s}`).forEach(a=>{a.disabled=!0;const o=a.closest("label");o.classList.remove("hover:bg-stone-50","cursor-pointer"),a.value===n.correctAnswer&&o.classList.add("bg-green-100","border-green-300"),a.checked&&!n.isCorrect&&o.classList.add("bg-red-100","border-red-300")})}),document.getElementById("dokkai-form").querySelector('button[type="submit"]').classList.add("hidden"),b(f())},I=function(e){if(listeningContainer.innerHTML="",e.length===0){listeningContainer.innerHTML='<p class="text-sm">Coming soon.</p>';return}e.forEach((t,n)=>{const s=t.image_url||"",i=t.description&&t.description.trim()!==""&&t.description.trim()!=="<p><br></p>",a=t.script&&t.script.trim()!==""&&t.script.trim()!=="<p><br></p>";let o="";t.audio_urls&&t.audio_urls.length>0?t.audio_urls.forEach((r,l)=>{r&&(o+=`
  <div class="flex justify-center">
  <a
  href="${r}"
  class="inline-flex items-center justify-center w-full sm:w-auto px-6 py-3 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2"
a  >
  Audio ${l+1}
  </a>
  </div>
 `)}):o='<p class="text-sm text-red-500">Audio tidak ditemukan.</p>',listeningContainer.innerHTML+=`
 <div class="bg-white p-6 rounded-lg border border-stone-200 space-y-4">
 <h3 class="js-romaji-target text-lg font-semibold text-stone-900">
 ${t.title||`Latihan Mendengar ${n+1}`}
 </h3>
 ${i?`
 <div class="pb-4 border-b border-stone-100">
  <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">
  Petunjuk
  </h4>
  <div class="ql-container">
  <div class="ql-editor">${t.description}</div>
  </div>
 </div>
 `:""}
 ${s?`
 <div>
  <img
  src="${s}"
  alt="Gambar untuk ${t.title||"latihan"}"
  class="w-full max-h-80 object-contain rounded-lg bg-stone-100"
  >
 </div>
 `:""}
 ${o}
 ${a?`
 <div class="pt-4 border-t border-stone-100">
  <button
  type="button"
  class="toggle-script-btn text-sm font-medium text-stone-600 hover:text-stone-900 transition-colors duration-200 flex items-center gap-2"
  data-target="script-${t.id}"
 _ >
  <i class="fa-solid fa-eye w-4"></i>
  <span>Tampilkan Teks Jawaban</span>
  </button>
  <div id="script-${t.id}" class="choukai-script-container">
  <div class="ql-container">
  <div class="js-romaji-target ql-editor">${t.script}</div>
  </div>
  </div>
 </div>
 `:""}
 </div>
 `}),T()},T=function(){listeningContainer.addEventListener("click",e=>{const t=e.target.closest(".toggle-script-btn");if(!t)return;const n=t.dataset.target,s=document.getElementById(n),i=t.querySelector("i"),a=t.querySelector("span");s&&(s.classList.toggle("visible")?(i.classList.remove("fa-eye"),i.classList.add("fa-eye-slash"),a.textContent="Sembunyikan Teks Jawaban",b(f())):(i.classList.remove("fa-eye-slash"),i.classList.add("fa-eye"),a.textContent="Tampilkan Teks Jawaban"))})},$=function(e,t){if(!modal)return;const n=document.getElementById("swiper-wrapper-modal");n&&(n.innerHTML="",e.forEach(s=>{n.innerHTML+=`
 <div class="swiper-slide">
  <div class="swiper-zoom-container">
    <img src="${s}" alt="Gambar Bunpou" />
  </div>
 </div>
 `}),modal.classList.remove("hidden"),modalSwiper&&modalSwiper.destroy(),modalSwiper=new Swiper(".modal-swiper",{initialSlide:t,loop:e.length>1,pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},keyboard:{enabled:!0},zoom:{maxRatio:5,toggle:!0}}))},x=function(){if(!modal)return;modal.classList.add("hidden"),modalSwiper&&(modalSwiper.destroy(),modalSwiper=null);const e=document.getElementById("swiper-wrapper-modal");e&&(e.innerHTML="")},f=function(){return localStorage.getItem(ROMAJI_PREF_KEY)==="true"},B=function(e){localStorage.setItem(ROMAJI_PREF_KEY,e),j(e),b(e)},H=function(){const e=f();B(!e)},j=function(e){const t=document.getElementById("romaji-toggle-btn"),n=document.getElementById("romaji-toggle-icon");!t||!n||(e?(t.classList.add("bg-stone-800","text-white"),t.classList.add("dark:bg-stone-200","dark:text-stone-900"),n.textContent="A"):(t.classList.remove("bg-stone-800","text-white"),t.classList.remove("dark:bg-stone-200","dark:text-stone-900"),n.textContent="\u3042"))},b=function(e){document.querySelectorAll(".js-romaji-target").forEach(n=>{if(n.dataset.originalHtml===void 0&&(n.dataset.originalHtml=n.innerHTML||""),e){let o=function(r){r.nodeType===Node.TEXT_NODE?r.textContent.trim().length>0&&(r.textContent=wanakana.toRomaji(r.textContent,{upcaseKatakana:!0})):r.nodeType===Node.ELEMENT_NODE&&r.childNodes.forEach(o)};var s=o;const i=n.dataset.originalHtml;if(i===""){n.innerHTML="";return}const a=document.createElement("div");a.innerHTML=i,o(a),n.innerHTML=a.innerHTML}else n.innerHTML=n.dataset.originalHtml})};var renderChapterTitle=h,renderVocab=m,renderGrammar=g,renderReading=v,renderDokkaiResults=u,renderListening=I,setupListeningToggles=T,openImageSwiperModal=$,closeModal=x,getRomajiPref=f,setRomajiPref=B,toggleRomajiPref=H,updateRomajiToggleButton=j,applyGlobalRomaji=b;quizButton.href=`/quiz?babId=${babId}`,document.getElementById("tab-nav").addEventListener("click",e=>{if(e.target.tagName==="BUTTON"){const t=e.target.dataset.tab;document.querySelectorAll(".tab-pane").forEach(n=>n.classList.add("hidden")),document.querySelectorAll("#tab-nav button").forEach(n=>{n.className=n.getAttribute("class_default")}),document.getElementById(t).classList.remove("hidden"),e.target.className=e.target.getAttribute("class_active"),e.target.classList.add("border-stone-900")}});function w(){return d(this,null,function*(){try{console.log("Judul bab di-fetch dari server...");const t=yield(yield fetch("/api/chapters")).json();h(t)}catch(e){console.error("Error fetching chapter info:",e),titleEl.textContent="Error"}})}function L(){return d(this,null,function*(){try{console.log("Kosakata di-fetch dari server...");const t=yield(yield fetch(`/api/vocabularies/${babId}`)).json();m(t)}catch(e){console.error("Error fetching vocab:",e),vocabContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat kosakata.</p>'}})}function E(){return d(this,null,function*(){try{console.log("Pola kalimat di-fetch dari server...");const t=yield(yield fetch(`/api/grammar/${babId}`)).json();g(t)}catch(e){console.error("Error fetching grammar:",e),grammarContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat pola kalimat.</p>'}})}function p(){return d(this,null,function*(){try{console.log("Dokkai di-fetch dari server...");const t=yield(yield fetch(`/api/reading/${babId}`)).json();v(t)}catch(e){console.error("Error fetching reading exercises:",e),readingContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat latihan membaca.</p>'}})}function c(e){return d(this,null,function*(){e.preventDefault();const t=e.target,n=new FormData(t),s=[];for(let[a,o]of n.entries())if(a.startsWith("dokkai_q_")){const r=parseInt(a.split("_")[2]);s.push({questionId:r,answer:o})}const i=t.querySelector('button[type="submit"]');i.disabled=!0,i.textContent="Memeriksa...";try{const a=yield fetch(`/api/submit-reading/${babId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:s})});if(!a.ok)throw new Error("Gagal mengirim jawaban");const o=yield a.json();u(o)}catch(a){console.error("Error submitting dokkai:",a),i.disabled=!1,i.textContent="Error! Coba Lagi"}})}function M(){return d(this,null,function*(){try{console.log("Choukai di-fetch dari server...");const t=yield(yield fetch(`/api/listening/${babId}`)).json();I(t)}catch(e){console.error("Error fetching listening exercises:",e),listeningContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat latihan mendengar.</p>'}})}document.addEventListener("DOMContentLoaded",()=>{function e(){return d(this,null,function*(){yield w(),yield Promise.all([L(),E(),p(),M()]);const o=f();j(o),b(o)})}e();const t=document.getElementById("romaji-toggle-btn");t&&t.addEventListener("click",H),mainContent.addEventListener("click",o=>{const r=o.target.closest(".bunpou-image");if(r){o.preventDefault();try{const l=r.dataset.groupImages,k=JSON.parse(l),y=parseInt(r.dataset.imageIndex,10);$(k,y)}catch(l){console.error("Gagal membuka galeri:",l),$([r.src],0)}}}),modalCloseBtn.addEventListener("click",x),modal.addEventListener("click",o=>{o.target===modal&&x()}),window.addEventListener("keydown",o=>{o.key==="Escape"&&!modal.classList.contains("hidden")&&x()});const n=document.getElementById("theme-toggle-btn"),s=document.getElementById("theme-icon-sun"),i=document.getElementById("theme-icon-moon"),a=document.documentElement;a.classList.contains("dark")?(s.classList.add("hidden"),i.classList.remove("hidden")):(s.classList.remove("hidden"),i.classList.add("hidden")),n.addEventListener("click",()=>{const o=a.classList.contains("dark"),r=o?"light":"dark",l=o?i:s,k=o?s:i,y=gsap.timeline();y.to(l,{duration:.3,opacity:0,rotation:180,scale:.5,ease:"power2.in",onComplete:()=>{l.classList.add("hidden"),k.classList.remove("hidden"),applyTheme(r)}}),y.from(k,{duration:.3,opacity:0,rotation:-180,scale:.5,ease:"power2.out"})})})}</script></body></html>