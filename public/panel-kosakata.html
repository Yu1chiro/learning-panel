<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Panel Kosakata</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script><style>.list-item{cursor:grab}.list-item.sortable-ghost{opacity:.4;background:#f0f9ff}.list-item.sortable-chosen{cursor:grabbing}.divider-item{cursor:grab;background-color:#f8fafc}.divider-item .drag-handle,.list-item .drag-handle{cursor:grab}.divider-item:active .drag-handle,.list-item:active .drag-handle{cursor:grabbing}</style></head><body class="bg-stone-50 antialiased min-h-screen"><nav class="bg-white border-b border-stone-200 backdrop-blur-sm bg-white/90 sticky top-0 z-10"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-wrap justify-between items-center gap-4"><h1 id="panel-title" class="text-lg font-semibold text-stone-900 tracking-tight">Kelola Kosakata</h1><div class="flex items-center gap-3"><a href="/dashboard" class="text-sm font-medium text-stone-600 hover:text-stone-900 transition-colors duration-200">Kembali ke Dashboard</a> <a href="/api/logout" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Logout</a></div></div></nav><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-5xl"><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8 mb-8"><h2 id="form-title" class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Tambah Kosakata Baru</h2><form id="add-vocab-form" class="space-y-5"><input type="hidden" id="editingId" value=""><div><label for="kosakata" class="block text-sm font-medium text-stone-700 mb-2">Kosakata (Jepang)</label> <input type="text" id="kosakata" name="kosakata" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="Contoh: 新しい (atarashii)" required></div><div><label for="arti" class="block text-sm font-medium text-stone-700 mb-2">Arti (Indonesia)</label> <input type="text" id="arti" name="arti" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="Contoh: Baru" required></div><div><label for="image_url" class="block text-sm font-medium text-stone-700 mb-2">URL Thumbnail (Opsional)</label> <input type="url" id="image_url" name="image_url" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="https://... (URL gambar ilustrasi)"></div><div class="flex items-center gap-3"><button type="submit" id="submit-button" class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Simpan Kosakata</button> <button type="button" id="cancel-edit-button" class="hidden inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Batal Edit</button></div></form></div><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8 mb-8"><h2 class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Tambah Pembatas</h2><form id="add-divider-form" class="sm:flex sm:items-end sm:gap-4 space-y-4 sm:space-y-0"><div class="flex-1"><label for="divider_text" class="block text-sm font-medium text-stone-700 mb-2">Teks Pembatas</label> <input type="text" id="divider_text" name="divider_text" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="Contoh: Kata Sifat" required></div><button type="submit" id="submit-divider-button" class="w-full sm:w-auto inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2">Simpan Pembatas</button></form></div><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8"><h2 class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Daftar Kosakata & Pembatas</h2><div id="vocab-list" class="space-y-3"><p class="text-sm text-stone-500">Memuat...</p></div></div></main><script>var s=(n,e,t)=>new Promise((a,r)=>{var o=i=>{try{c(t.next(i))}catch(d){r(d)}},l=i=>{try{c(t.throw(i))}catch(d){r(d)}},c=i=>i.done?a(i.value):Promise.resolve(i.value).then(o,l);c((t=t.apply(n,e)).next())});const urlParams=new URLSearchParams(window.location.search),babId=urlParams.get("babId"),babTitle=urlParams.get("title");document.getElementById("panel-title").textContent=`Kelola Kosakata: ${babTitle||""}`,document.title=`Panel Kosakata - ${babTitle||""}`;const vocabForm=document.getElementById("add-vocab-form"),dividerForm=document.getElementById("add-divider-form"),listContainer=document.getElementById("vocab-list"),formTitle=document.getElementById("form-title"),submitButton=document.getElementById("submit-button"),cancelEditButton=document.getElementById("cancel-edit-button"),editingIdInput=document.getElementById("editingId"),kosakataInput=document.getElementById("kosakata"),artiInput=document.getElementById("arti"),imageUrlInput=document.getElementById("image_url"),dividerTextInput=document.getElementById("divider_text");let sortable=null;const showToast=(n,e="success")=>{Swal.fire({toast:!0,position:"top-end",icon:e,title:n,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})};function initSortable(){sortable&&sortable.destroy(),sortable=new Sortable(listContainer,{animation:150,ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",handle:".drag-handle",onEnd:n=>s(null,null,function*(){const e=sortable.toArray();try{if(!(yield fetch("/api/vocabularies/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({babId,orderedIds:e})})).ok)throw new Error("Gagal menyimpan urutan");showToast("Urutan berhasil disimpan.","success"),fetchVocab(!1)}catch(t){showToast(t.message,"error"),console.error("Error saving order:",t)}})})}function fetchVocab(n=!0){return s(this,null,function*(){if(!babId){listContainer.innerHTML='<p class="text-sm text-red-600">ID Bab tidak ditemukan.</p>';return}try{const t=yield(yield fetch(`/api/admin/vocabularies/${babId}`)).json();if(listContainer.innerHTML="",t.length===0){listContainer.innerHTML='<p class="text-sm text-stone-500">Belum ada kosakata atau pembatas.</p>';return}t.forEach(a=>{if(a.item_type==="divider")listContainer.innerHTML+=`
              <div class="divider-item border border-blue-200 rounded-lg p-4 sm:p-5 flex items-center justify-between gap-4" data-id="${a.id}">
                <div class="flex items-center gap-3 min-w-0">
                  <span class="drag-handle flex-shrink-0 text-stone-400 hover:text-stone-600" title="Geser">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>
                  </span>
                  <p class="text-base font-semibold text-blue-800 truncate" title="${a.kosakata}">${a.kosakata}</p>
                </div>
                <div class="flex-shrink-0 flex items-center gap-2">
                  <button class="edit-divider-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md" data-id="${a.id}" data-text="${a.kosakata}">
                    Edit
                  </button>
                  <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md" data-id="${a.id}">
                    Hapus
                  </button>
                </div>
              </div>
            `;else{const r=a.image_url?a.image_url:"Tidak ada gambar";listContainer.innerHTML+=`
              <div class="list-item border border-stone-200 rounded-lg p-4 sm:p-5 hover:border-stone-300 transition-colors duration-200" data-id="${a.id}">
                <div class="flex items-start justify-between gap-4">
                  <div class="flex items-start gap-3 min-w-0">
                    <span class="drag-handle flex-shrink-0 text-stone-400 hover:text-stone-600 mt-1.5" title="Geser">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>
                    </span>
                    <div class="flex-1 min-w-0">
                      <p class="text-lg font-semibold text-stone-900">${a.kosakata||""}</p>
                      <p class="text-sm text-stone-700 mt-1">${a.arti||""}</p>
                      <p class="text-xs text-stone-500 mt-2 truncate" title="${r}">
                        URL: ${r}
                      </p>
                    </div>
                  </div>
                  <div class="flex-shrink-0 flex items-center gap-2 mt-1">
                    <button class="edit-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-md" data-id="${a.id}">
                      Edit
                    </button>
                    <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md" data-id="${a.id}">
                      Hapus
                    </button>
                  </div>
                </div>
              </div>
            `}}),n&&initSortable()}catch(e){listContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat data.</p>'}})}vocabForm.addEventListener("submit",n=>s(null,null,function*(){n.preventDefault();const e=kosakataInput.value,t=artiInput.value,a=imageUrlInput.value.trim();if(!e||!t){showToast("Kosakata dan Arti tidak boleh kosong!","warning");return}const r=editingIdInput.value,o=!!r,l=o?`/api/vocabularies/${r}`:"/api/vocabularies",c=o?"PUT":"POST",i={kosakata:e,arti:t,image_url:a||null};o||(i.bab_id=babId);const d=JSON.stringify(i);try{if(!(yield fetch(l,{method:c,headers:{"Content-Type":"application/json"},body:d})).ok)throw new Error(o?"Gagal memperbarui":"Gagal menyimpan");resetForm(),fetchVocab(),showToast(o?"Kosakata berhasil diperbarui.":"Kosakata berhasil disimpan.")}catch(m){showToast(m.message,"error")}})),dividerForm.addEventListener("submit",n=>s(null,null,function*(){n.preventDefault();const e=dividerTextInput.value;if(!e){showToast("Teks pembatas tidak boleh kosong!","warning");return}try{if(!(yield fetch("/api/vocab-divider",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bab_id:babId,kosakata:e})})).ok)throw new Error("Gagal menyimpan pembatas");dividerTextInput.value="",fetchVocab(),showToast("Pembatas berhasil disimpan.")}catch(t){showToast(t.message,"error")}})),listContainer.addEventListener("click",n=>{const e=n.target.closest("button");if(!e)return;const t=e.dataset.id;if(e.classList.contains("delete-btn"))deleteItem(t);else if(e.classList.contains("edit-btn"))editVocab(t);else if(e.classList.contains("edit-divider-btn")){const a=e.dataset.text;editDivider(t,a)}});function deleteItem(n){Swal.fire({title:"Anda yakin?",text:"Item ini akan dihapus permanen (kosakata atau pembatas).",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",cancelButtonText:"Batal",confirmButtonText:"Ya, hapus!"}).then(e=>s(null,null,function*(){if(e.isConfirmed)try{if(!(yield fetch(`/api/vocabularies/${n}`,{method:"DELETE"})).ok)throw new Error("Gagal menghapus");fetchVocab(),showToast("Item berhasil dihapus."),resetForm()}catch(t){showToast(t.message,"error")}}))}function editVocab(n){return s(this,null,function*(){try{const e=yield fetch(`/api/vocabulary/${n}`);if(!e.ok)throw new Error("Gagal mengambil data");const t=yield e.json();if(t.item_type!=="vocab"){showToast("Item ini bukan kosakata.","error");return}kosakataInput.value=t.kosakata||"",artiInput.value=t.arti||"",imageUrlInput.value=t.image_url||"",editingIdInput.value=t.id,formTitle.textContent="Edit Konten Kosakata",submitButton.textContent="Simpan Perubahan",cancelEditButton.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),kosakataInput.focus()}catch(e){showToast(e.message,"error")}})}function editDivider(n,e){return s(this,null,function*(){const{value:t}=yield Swal.fire({title:"Edit Teks Pembatas",input:"text",inputValue:e,showCancelButton:!0,confirmButtonText:"Simpan",cancelButtonText:"Batal",inputValidator:a=>{if(!a)return"Teks tidak boleh kosong!"}});if(t&&t!==e)try{if(!(yield fetch(`/api/vocab-divider/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({kosakata:t})})).ok)throw new Error("Gagal memperbarui pembatas");fetchVocab(),showToast("Pembatas berhasil diperbarui.")}catch(a){showToast(a.message,"error")}})}function resetForm(){vocabForm.reset(),editingIdInput.value="",formTitle.textContent="Tambah Kosakata Baru",submitButton.textContent="Simpan Kosakata",cancelEditButton.classList.add("hidden")}cancelEditButton.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",()=>{fetchVocab()});</script></body></html>