<!DOCTYPE html><html lang="id" class=""><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kuis JLPT</title><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1&display=swap" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet"><script src="https://unpkg.com/wanakana"></script><script>tailwind.config={darkMode:"class"};</script><style>body{font-family:"Shippori Mincho B1",serif!important;font-weight:400;font-style:normal}.ql-container.ql.snow{border:none}.ql-editor{padding:0;font-size:1rem;font-weight:500;color:#292524;line-height:1.625}.ql-editor p{margin-bottom:0}.dark .ql-editor{color:#f5f5f4}</style></head><body class="bg-stone-50 dark:bg-stone-900 text-stone-900 dark:text-stone-100 min-h-screen antialiased transition-colors duration-200"><header class="bg-white/90 dark:bg-stone-800/90 border-b border-stone-200 dark:border-stone-700 sticky top-0 z-10 backdrop-blur-sm"><nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center gap-4"><a href="#" id="back-to" class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors duration-200 flex items-center gap-2 group"><span class="transform group-hover:-translate-x-1 transition-transform duration-200">&larr;</span> <span>クイズ</span></a><div class="flex items-center gap-4"><h2 id="chapter-title" class="text-sm font-medium text-stone-500 dark:text-stone-400 text-right truncate max-w-xs sm:max-w-md">Kuis</h2><button id="romaji-toggle-btn" class="relative w-12 h-12 p-2 text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors duration-200 rounded-full hover:bg-stone-200 dark:hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-stone-800" aria-label="Toggle Romaji"><span id="romaji-toggle-icon" class="text-lg font-bold select-none absolute inset-0 m-auto flex items-center justify-center">あ</span></button> <button id="theme-toggle-btn" class="relative w-12 h-12 p-2 text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-colors duration-200 rounded-full hover:bg-stone-200 dark:hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-stone-800"><span class="sr-only">Toggle theme</span> <i id="sun-icon" class="fa-solid fa-sun text-xl absolute inset-0 m-auto"></i> <i id="moon-icon" class="fa-solid fa-moon text-xl absolute inset-0 m-auto"></i></button></div></nav></header><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12"><div id="quiz-container" class="bg-white dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-lg p-6 md:p-8 max-w-3xl mx-auto"><div id="loading" class="text-center py-8"><p class="text-sm text-stone-500 dark:text-stone-400">Memuat kuis...</p></div><form id="quiz-form" class="hidden"></form><div id="result-container" class="hidden text-center py-4"><h2 class="text-2xl font-semibold text-stone-900 dark:text-stone-100 mb-6 tracking-tight">Hasil Kuis Anda</h2><p class="text-6xl font-bold mb-4 tracking-tight" id="score-text">0%</p><p class="text-sm text-stone-600 dark:text-stone-400 mb-8" id="score-details">Anda benar 0 dari 0 soal.</p><div class="flex flex-col sm:flex-row gap-3 justify-center"><button onclick="window.location.reload();
" class="inline-flex items-center justify-center px-6 py-3 text-sm font-medium text-stone-900 dark:text-stone-100 bg-white dark:bg-stone-700 border border-stone-300 dark:border-stone-600 hover:bg-stone-50 dark:hover:bg-stone-600 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Coba Lagi</button> <a id="back-to-study" href="#" class="inline-flex items-center justify-center px-6 py-3 text-sm font-medium text-white dark:text-stone-900 bg-stone-900 dark:bg-stone-100 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Kembali Belajar</a></div></div></div></main><script>(function(){try{const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e==="dark"||!e&&t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}catch(e){}})();</script><script>var p=(m,i,a)=>new Promise((x,d)=>{var g=s=>{try{c(a.next(s))}catch(l){d(l)}},b=s=>{try{c(a.throw(s))}catch(l){d(l)}},c=s=>s.done?x(s.value):Promise.resolve(s.value).then(g,b);c((a=a.apply(m,i)).next())});const urlParams=new URLSearchParams(window.location.search),babId=urlParams.get("babId"),loadingEl=document.getElementById("loading"),quizForm=document.getElementById("quiz-form"),resultContainer=document.getElementById("result-container"),scoreText=document.getElementById("score-text"),scoreDetails=document.getElementById("score-details"),backToStudy=document.getElementById("back-to-study"),backTo=document.getElementById("back-to"),ROMAJI_PREF_KEY="romaji-preference";let questions=[];if(!babId)loadingEl.innerHTML='<p class="text-sm text-red-600 font-medium mb-2">Error: ID Bab tidak valid.</p><a href="/" class="text-sm text-stone-900 dark:text-stone-100 hover:text-stone-700 dark:hover:text-stone-300 underline">Kembali ke Home</a>';else{let i=function(){return localStorage.getItem(ROMAJI_PREF_KEY)==="true"},a=function(t){localStorage.setItem(ROMAJI_PREF_KEY,t),d(t),g(t)},x=function(){const t=i();a(!t)},d=function(t){const e=document.getElementById("romaji-toggle-btn"),n=document.getElementById("romaji-toggle-icon");!e||!n||(t?(e.classList.add("bg-stone-800","text-white"),e.classList.add("dark:bg-stone-200","dark:text-stone-900"),n.textContent="A"):(e.classList.remove("bg-stone-800","text-white"),e.classList.remove("dark:bg-stone-200","dark:text-stone-900"),n.textContent="\u3042"))},g=function(t){document.querySelectorAll(".js-romaji-target").forEach(n=>{if(n.dataset.originalHtml===void 0&&(n.dataset.originalHtml=n.innerHTML||""),t){let k=function(u){u.nodeType===Node.TEXT_NODE?u.textContent.trim().length>0&&(u.textContent=wanakana.toRomaji(u.textContent,{upcaseKatakana:!0})):u.nodeType===Node.ELEMENT_NODE&&u.childNodes.forEach(k)};var o=k;const r=n.dataset.originalHtml;if(r===""){n.innerHTML="";return}const h=document.createElement("div");h.innerHTML=r,k(h),n.innerHTML=h.innerHTML}else n.innerHTML=n.dataset.originalHtml})},b=function(t,e,n=!1){loadingEl.classList.add("hidden"),quizForm.classList.add("hidden"),resultContainer.classList.remove("hidden");const o=e>0?t/e*100:0;if(scoreText.textContent=`${o.toFixed(0)}%`,scoreDetails.textContent=`Anda benar ${t} dari ${e} soal.`,n){scoreDetails.textContent+=" (Kuis telah diambil. Anda bisa coba lagi besok.)";const r=resultContainer.querySelector('button[onclick="window.location.reload()"]');r&&r.classList.add("hidden")}scoreText.classList.remove("text-green-600","text-amber-600","text-red-600"),o>=80?scoreText.classList.add("text-green-600"):o>=50?scoreText.classList.add("text-amber-600"):scoreText.classList.add("text-red-600")},c=function(){try{const t=localStorage.getItem(m);if(!t){s();return}const e=JSON.parse(t),n=Date.now()-e.timestamp,o=1440*60*1e3;n<o?b(e.score,e.total,!0):(localStorage.removeItem(m),s())}catch(t){console.warn("Gagal membaca local storage, lanjut ambil kuis:",t),s()}},l=function(){loadingEl.classList.add("hidden"),quizForm.classList.remove("hidden");let t="";questions.forEach((e,n)=>{t+=`
          <div class="mb-8 pb-8 border-b border-stone-100 dark:border-stone-700 last:border-b-0">
            <div class="flex items-start mb-4">
              <span class="text-base font-medium text-stone-900 dark:text-stone-100 mr-2 shrink-0">${n+1}.</span>
              <div class="ql-container">
                <div class="js-romaji-target ql-editor">${e.question}</div>
              </div>
            </div>
            <div class="space-y-2 mt-5 pl-6">
              ${f(e.id,"A",e.option_a)}
              ${f(e.id,"B",e.option_b)}
              ${f(e.id,"C",e.option_c)}
              ${f(e.id,"D",e.option_d)}
            </div>
          </div>
        `}),t+='<button type="submit" class="w-full bg-stone-900 dark:bg-stone-100 hover:bg-stone-800 dark:hover:bg-stone-200 text-white dark:text-stone-900 font-medium py-3 px-6 rounded-lg text-sm transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Submit Jawaban</button>',quizForm.innerHTML=t},f=function(t,e,n){return`
        <div>
          <label class="flex items-start p-4 rounded-lg border border-stone-200 dark:border-stone-700 hover:border-stone-300 dark:hover:border-stone-500 hover:bg-stone-50 dark:hover:bg-stone-700 cursor-pointer transition-all duration-200 group">
            <input type="radio" name="question_${t}" value="${e}" class="mt-0.5 mr-3 text-stone-900 dark:text-stone-100 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-0" required>
            <span class="js-romaji-target text-sm text-stone-700 dark:text-stone-300 group-hover:text-stone-900 dark:group-hover:text-stone-100 transition-colors duration-200">${e}. ${n}</span>
          </label>
        </div>
      `};var getRomajiPref=i,setRomajiPref=a,toggleRomajiPref=x,updateRomajiToggleButton=d,applyGlobalRomaji=g,showResults=b,checkQuizStatusAndLoad=c,renderQuiz=l,renderOption=f;backToStudy.href=`/study?babId=${babId}`,backTo.href=`/study?babId=${babId}`;const m=`quiz_results_${babId}`;function s(){return p(this,null,function*(){try{const t=yield fetch(`/api/quizzes/${babId}`);if(!t.ok)throw new Error("Gagal mengambil data kuis.");if(questions=yield t.json(),questions.length===0){loadingEl.textContent="Belum ada kuis untuk bab ini.",loadingEl.classList.add("text-stone-500","dark:text-stone-400");return}l(),g(i())}catch(t){console.error("Error fetching quiz:",t),loadingEl.textContent="Gagal memuat kuis.",loadingEl.classList.add("text-red-600")}})}quizForm.addEventListener("submit",t=>p(null,null,function*(){t.preventDefault();const e=[];questions.forEach(n=>{const o=quizForm.querySelector(`input[name="question_${n.id}"]:checked`);e.push({questionId:n.id,answer:o?o.value:null})});try{const n=yield fetch(`/api/submit-quiz/${babId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:e})});if(!n.ok)throw new Error("Gagal mengirimkan jawaban.");const o=yield n.json(),r={score:o.score,total:o.total,timestamp:Date.now()};try{localStorage.setItem(m,JSON.stringify(r))}catch(h){console.warn("Gagal menyimpan hasil kuis ke local storage",h)}b(o.score,o.total,!1)}catch(n){console.error("Error submitting quiz:",n),alert("Gagal mensubmit kuis. Silakan coba lagi.")}})),document.addEventListener("DOMContentLoaded",()=>{c();const t=document.getElementById("romaji-toggle-btn");t&&t.addEventListener("click",x),d(i())})}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script><script>document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("theme-toggle-btn"),e=document.getElementById("sun-icon"),a=document.getElementById("moon-icon"),t=document.documentElement;function o(s){s?(gsap.to(e,{rotation:90,scale:0,opacity:0,duration:.3,ease:"power1.in"}),gsap.fromTo(a,{rotation:-90,scale:0,opacity:0},{rotation:0,scale:1,opacity:1,duration:.3,ease:"power1.out",delay:.1})):(gsap.to(a,{rotation:90,scale:0,opacity:0,duration:.3,ease:"power1.in"}),gsap.fromTo(e,{rotation:-90,scale:0,opacity:0},{rotation:0,scale:1,opacity:1,duration:.3,ease:"power1.out",delay:.1}))}function c(){t.classList.contains("dark")?(gsap.set(e,{scale:0,opacity:0,rotation:90}),gsap.set(a,{scale:1,opacity:1,rotation:0})):(gsap.set(e,{scale:1,opacity:1,rotation:0}),gsap.set(a,{scale:0,opacity:0,rotation:-90}))}c(),n.addEventListener("click",()=>{t.classList.contains("dark")?(t.classList.remove("dark"),localStorage.setItem("theme","light"),o(!1)):(t.classList.add("dark"),localStorage.setItem("theme","dark"),o(!0))}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",s=>{localStorage.getItem("theme")||(s.matches?(t.classList.add("dark"),o(!0)):(t.classList.remove("dark"),o(!1)))})});</script></body></html>