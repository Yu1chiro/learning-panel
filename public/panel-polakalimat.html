<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Panel Pola Kalimat</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script><script>const THEME_KEY="theme-preference",htmlEl=document.documentElement,applyTheme=e=>{e==="dark"?htmlEl.classList.add("dark"):htmlEl.classList.remove("dark"),localStorage.setItem(THEME_KEY,e)},getPreferredTheme=()=>{const e=localStorage.getItem(THEME_KEY);return e||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")};applyTheme(getPreferredTheme()),tailwind.config={darkMode:"class",theme:{extend:{colors:{stone:{850:"#1f1c1a",950:"#0c0a09"}}}}};</script><style>:root{--bg-color:#f5f5f4;--text-primary:#1c1917}.dark{--bg-color:#1c1917;--text-primary:#f5f5f4}body{background-color:var(--bg-color);color:var(--text-primary);transition:background-color .3s ease,color .3s ease}.prose .ql-container{border:none}.prose .ql-editor{padding:0}.prose .ql-editor p{margin-top:0;margin-bottom:1em}.prose .ql-editor ol,.prose .ql-editor ul{margin-top:1em;margin-bottom:1em}.prose .ql-editor h1,.prose .ql-editor h2,.prose .ql-editor h3{margin-bottom:.5em}.sortable-ghost{opacity:.4;background-color:#e0f2fe;border:1px dashed #0ea5e9}.dark .sortable-ghost{background-color:#0c4a6e;border-color:#38bdf8}.sortable-chosen{cursor:grabbing}.dark .ql-toolbar{background-color:#1f1c1a!important;border-color:#44403c!important}.dark .ql-container{background-color:#1f1c1a!important;border-color:#44403c!important;color:#f5f5f4!important}.dark .ql-stroke{stroke:#e5e5e5!important}.dark .ql-fill{fill:#e5e5e5!important}.dark .ql-picker{color:#e5e5e5!important}</style></head><body class="antialiased min-h-screen"><nav class="bg-white dark:bg-stone-900 border-b border-stone-200 dark:border-stone-700 backdrop-blur-sm bg-white/90 dark:bg-stone-900/90 sticky top-0 z-10 transition-colors"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-wrap justify-between items-center gap-4"><h1 id="panel-title" class="text-lg font-semibold text-stone-900 dark:text-stone-100 tracking-tight">Kelola Pola Kalimat</h1><div class="flex items-center gap-3"><button id="theme-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-full text-stone-600 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors focus:outline-none"><i id="theme-icon-sun" class="fa-solid fa-sun text-xl"></i> <i id="theme-icon-moon" class="fa-solid fa-moon text-xl hidden"></i></button> <a href="/dashboard" class="text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-200 transition-colors duration-200">Kembali ke Dashboard</a> <a href="/api/logout" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-stone-900 dark:bg-stone-100 dark:text-stone-900 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200">Logout</a></div></div></nav><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-6xl"><div class="bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 shadow-sm p-6 sm:p-8 mb-8 transition-colors"><h2 id="form-title" class="text-xl font-semibold text-stone-900 dark:text-stone-100 mb-6 tracking-tight">Tambah Pola Kalimat Baru</h2><form id="add-grammar-form" class="space-y-6"><input type="hidden" id="editingId" value=""><div><label for="pattern" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Pola Kalimat (cth: ～なければならない)</label> <input type="text" id="pattern" name="pattern" class="w-full px-4 py-2.5 text-sm text-stone-900 dark:text-stone-100 bg-white dark:bg-stone-900 border border-stone-300 dark:border-stone-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 transition-all duration-200 placeholder:text-stone-400 dark:placeholder:text-stone-500" placeholder="Masukkan pola kalimat" required></div><div><label class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">URL Gambar (Opsional)</label><div id="image-url-container" class="space-y-3"></div><button type="button" id="add-image-btn" class="mt-3 inline-flex items-center justify-center px-4 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-lg transition-colors duration-200">+ Tambah URL Gambar</button></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><label class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Penjelasan</label><div id="quill-explanation" class="bg-white dark:bg-stone-900 rounded-lg border border-stone-300 dark:border-stone-600 [&_.ql-toolbar]:border-b [&_.ql-toolbar]:border-stone-200 dark:[&_.ql-toolbar]:border-stone-600 [&_.ql-toolbar]:bg-stone-50/50 dark:[&_.ql-toolbar]:bg-stone-800 [&_.ql-toolbar]:rounded-t-lg [&_.ql-container]:border-none [&_.ql-container]:rounded-b-lg [&_.ql-editor]:min-h-[250px] [&_.ql-editor]:text-base [&_.ql-editor]:text-stone-900 dark:[&_.ql-editor]:text-stone-100 [&_.ql-editor]:leading-relaxed"></div></div><div><label class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Contoh Penggunaan</label><div id="quill-example" class="bg-white dark:bg-stone-900 rounded-lg border border-stone-300 dark:border-stone-600 [&_.ql-toolbar]:border-b [&_.ql-toolbar]:border-stone-200 dark:[&_.ql-toolbar]:border-stone-600 [&_.ql-toolbar]:bg-stone-50/50 dark:[&_.ql-toolbar]:bg-stone-800 [&_.ql-toolbar]:rounded-t-lg [&_.ql-container]:border-none [&_.ql-container]:rounded-b-lg [&_.ql-editor]:min-h-[250px] [&_.ql-editor]:text-base [&_.ql-editor]:text-stone-900 dark:[&_.ql-editor]:text-stone-100 [&_.ql-editor]:leading-relaxed"></div></div></div><div class="flex items-center gap-3"><button type="submit" id="submit-button" class="relative z-10 inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-stone-900 dark:bg-stone-100 dark:text-stone-900 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Simpan Pola Kalimat</button> <button type="button" id="cancel-edit-button" class="hidden relative z-10 inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Batal Edit</button></div></form></div><div class="bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 shadow-sm p-6 sm:p-8 transition-colors"><div class="flex items-center justify-between mb-6"><h2 class="text-xl font-semibold text-stone-900 dark:text-stone-100 tracking-tight">Daftar Pola Kalimat</h2><p class="text-sm text-stone-500 dark:text-stone-400 italic">Drag & drop untuk mengubah urutan</p></div><div id="grammar-list" class="space-y-4"><p class="text-sm text-stone-500 dark:text-stone-400">Memuat...</p></div></div></main><script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script><script>var d=(a,e,t)=>new Promise((n,r)=>{var s=o=>{try{l(t.next(o))}catch(c){r(c)}},m=o=>{try{l(t.throw(o))}catch(c){r(c)}},l=o=>o.done?n(o.value):Promise.resolve(o.value).then(s,m);l((t=t.apply(a,e)).next())});const urlParams=new URLSearchParams(window.location.search),babId=urlParams.get("babId"),babTitle=urlParams.get("title");document.getElementById("panel-title").textContent=`Kelola Pola Kalimat: ${babTitle||""}`,document.title=`Panel Pola Kalimat - ${babTitle||""}`;const toggleBtn=document.getElementById("theme-toggle-btn"),sunIcon=document.getElementById("theme-icon-sun"),moonIcon=document.getElementById("theme-icon-moon");htmlEl.classList.contains("dark")?(sunIcon.classList.add("hidden"),moonIcon.classList.remove("hidden")):(sunIcon.classList.remove("hidden"),moonIcon.classList.add("hidden")),toggleBtn.addEventListener("click",()=>{const a=htmlEl.classList.contains("dark"),e=a?"light":"dark",t=a?moonIcon:sunIcon,n=a?sunIcon:moonIcon,r=gsap.timeline();r.to(t,{duration:.3,opacity:0,rotation:180,scale:.5,ease:"power2.in",onComplete:()=>{t.classList.add("hidden"),n.classList.remove("hidden"),applyTheme(e)}}),r.from(n,{duration:.3,opacity:0,rotation:-180,scale:.5,ease:"power2.out"})});const quillToolbarOptions=[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["clean"]],quillExplanation=new Quill("#quill-explanation",{theme:"snow",modules:{toolbar:quillToolbarOptions}}),quillExample=new Quill("#quill-example",{theme:"snow",modules:{toolbar:quillToolbarOptions}}),form=document.getElementById("add-grammar-form"),listContainer=document.getElementById("grammar-list"),formTitle=document.getElementById("form-title"),submitButton=document.getElementById("submit-button"),cancelEditButton=document.getElementById("cancel-edit-button"),editingIdInput=document.getElementById("editingId"),imageUrlContainer=document.getElementById("image-url-container"),addImageBtn=document.getElementById("add-image-btn"),showToast=(a,e="success")=>{Swal.fire({toast:!0,position:"top-end",icon:e,title:a,showConfirmButton:!1,timer:3e3,timerProgressBar:!0,background:htmlEl.classList.contains("dark")?"#292524":"#fff",color:htmlEl.classList.contains("dark")?"#f5f5f4":"#545454"})};function addImageInput(a=""){const e=document.createElement("div");e.className="flex items-center gap-2",e.innerHTML=`
        <input type="url" value="${a}" class="flex-1 w-full px-4 py-2.5 text-sm text-stone-900 dark:text-stone-100 bg-white dark:bg-stone-900 border border-stone-300 dark:border-stone-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 transition-all duration-200 placeholder:text-stone-400 dark:placeholder:text-stone-500" placeholder="https://... (URL gambar)">
        <button type="button" class="remove-image-btn flex-shrink-0 w-10 h-10 flex items-center justify-center text-sm font-medium text-red-600 bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:text-red-200 dark:hover:bg-red-800 rounded-lg transition-colors duration-200"><i class="fa-solid fa-trash-can"></i></button>
      `,imageUrlContainer.appendChild(e)}addImageBtn.addEventListener("click",()=>addImageInput("")),imageUrlContainer.addEventListener("click",a=>{a.target.closest(".remove-image-btn")&&a.target.closest(".remove-image-btn").parentElement.remove()});function fetchGrammar(){return d(this,null,function*(){if(!babId){listContainer.innerHTML='<p class="text-sm text-red-600">ID Bab tidak ditemukan.</p>';return}try{const e=yield(yield fetch(`/api/grammar/${babId}`)).json();if(listContainer.innerHTML="",e.length===0){listContainer.innerHTML='<p class="text-sm text-stone-500 dark:text-stone-400">Belum ada pola kalimat.</p>';return}e.forEach(t=>{const n=t.image_urls&&t.image_urls.length>0?`${t.image_urls.length} gambar`:"Tidak ada gambar";listContainer.innerHTML+=`
            <div class="grammar-item border border-stone-200 dark:border-stone-700 rounded-lg p-5 hover:border-stone-300 dark:hover:border-stone-600 transition-colors duration-200 bg-white dark:bg-stone-800" data-id="${t.id}">
              <div class="flex items-center justify-between">
                <h3 class="flex items-center text-lg font-semibold text-stone-900 dark:text-stone-100 mb-2 tracking-tight">
                  <i class="drag-handle fa-solid fa-grip-vertical text-stone-300 dark:text-stone-600 hover:text-stone-500 dark:hover:text-stone-400 cursor-move mr-3 transition-colors" title="Geser untuk mengubah urutan"></i>
                  ${t.pattern}
                </h3>
                <p class="text-xs text-stone-500 dark:text-stone-400 mb-2">${n}</p>
              </div>
              <div class="pl-8"> <div class="space-y-4">
                  <div>
                    <h4 class="text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide mb-2">Penjelasan</h4>
                    <div class="prose prose-stone dark:prose-invert prose-sm max-w-none [&_.ql-editor]:text-sm [&_.ql-editor]:leading-relaxed [&_.ql-editor]:text-stone-700 dark:[&_.ql-editor]:text-stone-300">
                      <div class="ql-container"><div class="ql-editor">${t.explanation||'<p class="text-stone-400 italic">Tidak ada penjelasan</p>'}</div></div>
                    </div>
                  </div>
                  <div>
                    <h4 class="text-xs font-medium text-stone-500 dark:text-stone-400 uppercase tracking-wide mb-2">Contoh</h4>
                    <div class="prose prose-stone dark:prose-invert prose-sm max-w-none [&_.ql-editor]:text-sm [&_.ql-editor]:leading-relaxed [&_.ql-editor]:text-stone-700 dark:[&_.ql-editor]:text-stone-300">
                      <div class="ql-container"><div class="ql-editor">${t.example||'<p class="text-stone-400 italic">Tidak ada contoh</p>'}</div></div>
                    </div>
                  </div>
                </div>
                <div class="mt-4 pt-4 border-t border-stone-100 dark:border-stone-700 flex justify-end gap-2">
                  <button class="edit-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-stone-900 dark:bg-stone-100 dark:text-stone-900 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-md" data-id="${t.id}">Edit</button>
                  <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md" data-id="${t.id}">Hapus</button>
                </div>
              </div>
            </div>
          `})}catch(a){listContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat data.</p>'}})}form.addEventListener("submit",a=>d(null,null,function*(){a.preventDefault();const e=form.pattern.value,t=quillExplanation.root.innerHTML,n=quillExample.root.innerHTML,r=editingIdInput.value,s=!!r,m=imageUrlContainer.querySelectorAll('input[type="url"]'),l=Array.from(m).map(i=>i.value.trim()).filter(i=>i.length>0);if(!e){showToast("Pola kalimat tidak boleh kosong!","warning");return}const o={pattern:e,explanation:t,example:n,image_urls:l};s||(o.bab_id=babId);const c=s?`/api/grammar/${r}`:"/api/grammar",u=s?"PUT":"POST";try{if(!(yield fetch(c,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error(s?"Gagal memperbarui":"Gagal menyimpan");resetForm(),fetchGrammar(),showToast(s?"Pola kalimat berhasil diperbarui.":"Pola kalimat berhasil disimpan.")}catch(i){showToast(i.message,"error")}})),listContainer.addEventListener("click",a=>{if(a.target.closest(".drag-handle"))return;const e=a.target.closest("button");if(!e)return;const t=e.dataset.id;e.classList.contains("delete-btn")?deleteGrammar(t):e.classList.contains("edit-btn")&&editGrammar(t)});function deleteGrammar(a){Swal.fire({title:"Anda yakin?",text:"Pola kalimat ini akan dihapus permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",cancelButtonText:"Batal",confirmButtonText:"Ya, hapus!",background:htmlEl.classList.contains("dark")?"#292524":"#fff",color:htmlEl.classList.contains("dark")?"#f5f5f4":"#545454"}).then(e=>d(null,null,function*(){if(e.isConfirmed)try{if(!(yield fetch(`/api/grammar/${a}`,{method:"DELETE"})).ok)throw new Error("Gagal menghapus");fetchGrammar(),showToast("Pola kalimat berhasil dihapus."),resetForm()}catch(t){showToast(t.message,"error")}}))}function editGrammar(a){return d(this,null,function*(){try{const e=yield fetch(`/api/grammar/entry/${a}`);if(!e.ok)throw new Error("Gagal mengambil data");const t=yield e.json();form.pattern.value=t.pattern,quillExplanation.root.innerHTML=t.explanation,quillExample.root.innerHTML=t.example,editingIdInput.value=t.id,imageUrlContainer.innerHTML="",t.image_urls&&t.image_urls.length>0&&t.image_urls.forEach(n=>{addImageInput(n)}),formTitle.textContent="Edit Pola Kalimat",submitButton.textContent="Simpan Perubahan",cancelEditButton.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),form.pattern.focus()}catch(e){showToast(e.message,"error")}})}function resetForm(){form.reset(),quillExplanation.root.innerHTML="",quillExample.root.innerHTML="",editingIdInput.value="",imageUrlContainer.innerHTML="",formTitle.textContent="Tambah Pola Kalimat Baru",submitButton.textContent="Simpan Pola Kalimat",cancelEditButton.classList.add("hidden")}cancelEditButton.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",()=>{fetchGrammar(),new Sortable(listContainer,{animation:150,ghostClass:"sortable-ghost",handle:".drag-handle",onEnd:a=>d(null,null,function*(){const e=listContainer.querySelectorAll(".grammar-item"),t=Array.from(e).map(n=>n.dataset.id);try{const n=yield fetch("/api/grammar/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({babId,orderedIds:t})});if(!n.ok)throw new Error("Gagal menyimpan urutan");if((yield n.json()).success)showToast("Urutan berhasil diperbarui.");else throw new Error("Gagal menyimpan urutan")}catch(n){showToast(n.message,"error"),fetchGrammar()}})})});</script></body></html>