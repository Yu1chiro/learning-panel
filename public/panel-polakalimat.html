<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Panel Pola Kalimat</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script><style>.prose .ql-container{border:none}.prose .ql-editor{padding:0}.prose .ql-editor p{margin-top:0;margin-bottom:1em}.prose .ql-editor ol,.prose .ql-editor ul{margin-top:1em;margin-bottom:1em}.prose .ql-editor h1,.prose .ql-editor h2,.prose .ql-editor h3{margin-bottom:.5em}.sortable-ghost{opacity:.4;background-color:#e0f2fe;border:1px dashed #0ea5e9}.sortable-chosen{cursor:grabbing}</style></head><body class="bg-stone-50 antialiased min-h-screen"><nav class="bg-white border-b border-stone-200 backdrop-blur-sm bg-white/90 sticky top-0 z-10"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-wrap justify-between items-center gap-4"><h1 id="panel-title" class="text-lg font-semibold text-stone-900 tracking-tight">Kelola Pola Kalimat</h1><div class="flex items-center gap-3"><a href="/dashboard" class="text-sm font-medium text-stone-600 hover:text-stone-900 transition-colors duration-200">Kembali ke Dashboard</a> <a href="/api/logout" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Logout</a></div></div></nav><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-6xl"><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8 mb-8"><h2 id="form-title" class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Tambah Pola Kalimat Baru</h2><form id="add-grammar-form" class="space-y-6"><input type="hidden" id="editingId" value=""><div><label for="pattern" class="block text-sm font-medium text-stone-700 mb-2">Pola Kalimat (cth: ～なければならない)</label> <input type="text" id="pattern" name="pattern" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="Masukkan pola kalimat" required></div><div><label class="block text-sm font-medium text-stone-700 mb-2">URL Gambar (Opsional)</label><div id="image-url-container" class="space-y-3"></div><button type="button" id="add-image-btn" class="mt-3 inline-flex items-center justify-center px-4 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors duration-200">+ Tambah URL Gambar</button></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div><label class="block text-sm font-medium text-stone-700 mb-2">Penjelasan</label><div id="quill-explanation" class="bg-white rounded-lg border border-stone-300 [&_.ql-toolbar]:border-b [&_.ql-toolbar]:border-stone-200 [&_.ql-toolbar]:bg-stone-50/50 [&_.ql-toolbar]:rounded-t-lg [&_.ql-container]:border-none [&_.ql-container]:rounded-b-lg [&_.ql-editor]:min-h-[250px] [&_.ql-editor]:text-base [&_.ql-editor]:text-stone-900 [&_.ql-editor]:leading-relaxed"></div></div><div><label class="block text-sm font-medium text-stone-700 mb-2">Contoh Penggunaan</label><div id="quill-example" class="bg-white rounded-lg border border-stone-300 [&_.ql-toolbar]:border-b [&_.ql-toolbar]:border-stone-200 [&_.ql-toolbar]:bg-stone-50/50 [&_.ql-toolbar]:rounded-t-lg [&_.ql-container]:border-none [&_.ql-container]:rounded-b-lg [&_.ql-editor]:min-h-[250px] [&_.ql-editor]:text-base [&_.ql-editor]:text-stone-900 [&_.ql-editor]:leading-relaxed"></div></div></div><div class="flex items-center gap-3"><button type="submit" id="submit-button" class="relative z-10 inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Simpan Pola Kalimat</button> <button type="button" id="cancel-edit-button" class="hidden relative z-10 inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Batal Edit</button></div></form></div><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8"><div class="flex items-center justify-between mb-6"><h2 class="text-xl font-semibold text-stone-900 tracking-tight">Daftar Pola Kalimat</h2><p class="text-sm text-stone-500 italic">Drag & drop untuk mengubah urutan</p></div><div id="grammar-list" class="space-y-4"><p class="text-sm text-stone-500">Memuat...</p></div></div></main><script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script><script>var l=(a,e,t)=>new Promise((n,i)=>{var o=r=>{try{d(t.next(r))}catch(c){i(c)}},m=r=>{try{d(t.throw(r))}catch(c){i(c)}},d=r=>r.done?n(r.value):Promise.resolve(r.value).then(o,m);d((t=t.apply(a,e)).next())});const urlParams=new URLSearchParams(window.location.search),babId=urlParams.get("babId"),babTitle=urlParams.get("title");document.getElementById("panel-title").textContent=`Kelola Pola Kalimat: ${babTitle||""}`,document.title=`Panel Pola Kalimat - ${babTitle||""}`;const quillToolbarOptions=[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["clean"]],quillExplanation=new Quill("#quill-explanation",{theme:"snow",modules:{toolbar:quillToolbarOptions}}),quillExample=new Quill("#quill-example",{theme:"snow",modules:{toolbar:quillToolbarOptions}}),form=document.getElementById("add-grammar-form"),listContainer=document.getElementById("grammar-list"),formTitle=document.getElementById("form-title"),submitButton=document.getElementById("submit-button"),cancelEditButton=document.getElementById("cancel-edit-button"),editingIdInput=document.getElementById("editingId"),imageUrlContainer=document.getElementById("image-url-container"),addImageBtn=document.getElementById("add-image-btn"),showToast=(a,e="success")=>{Swal.fire({toast:!0,position:"top-end",icon:e,title:a,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})};function addImageInput(a=""){const e=`image_url_${Date.now()}`,t=document.createElement("div");t.className="flex items-center gap-2",t.innerHTML=`
        <input 
          type="url" 
          value="${a}" 
          class="flex-1 w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" 
          placeholder="https://... (URL gambar)">
        <button 
          type="button" 
          class="remove-image-btn flex-shrink-0 w-10 h-10 flex items-center justify-center text-sm font-medium text-red-600 bg-red-100 hover:bg-red-200 rounded-lg transition-colors duration-200"
          aria-label="Hapus URL">
          <i class="fa-solid fa-trash-can"></i>
        </button>
      `,imageUrlContainer.appendChild(t)}addImageBtn.addEventListener("click",()=>addImageInput("")),imageUrlContainer.addEventListener("click",a=>{const e=a.target.closest(".remove-image-btn");e&&e.parentElement.remove()});function fetchGrammar(){return l(this,null,function*(){if(!babId){listContainer.innerHTML='<p class="text-sm text-red-600">ID Bab tidak ditemukan.</p>';return}try{const e=yield(yield fetch(`/api/grammar/${babId}`)).json();if(listContainer.innerHTML="",e.length===0){listContainer.innerHTML='<p class="text-sm text-stone-500">Belum ada pola kalimat.</p>';return}e.forEach(t=>{const n=t.image_urls&&t.image_urls.length>0?`${t.image_urls.length} gambar`:"Tidak ada gambar";listContainer.innerHTML+=`
            <div class="grammar-item border border-stone-200 rounded-lg p-5 hover:border-stone-300 transition-colors duration-200 bg-white" data-id="${t.id}">
              
              <div class="flex items-center justify-between">
                <h3 class="flex items-center text-lg font-semibold text-stone-900 mb-2 tracking-tight">
                  <i class="drag-handle fa-solid fa-grip-vertical text-stone-300 hover:text-stone-500 cursor-move mr-3 transition-colors" title="Geser untuk mengubah urutan"></i>
                  ${t.pattern}
                </h3>
                <p class="text-xs text-stone-500 mb-2">${n}</p>
              </div>
              
              <div class="pl-8"> <div class="space-y-4">
                  <div>
                    <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">Penjelasan</h4>
                    <div class="prose prose-stone prose-sm max-w-none [&_.ql-editor]:text-sm [&_.ql-editor]:leading-relaxed [&_.ql-editor]:text-stone-700">
                      <div class="ql-container">
                        <div class="ql-editor">${t.explanation||'<p class="text-stone-400 italic">Tidak ada penjelasan</p>'}</div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <h4 class="text-xs font-medium text-stone-500 uppercase tracking-wide mb-2">Contoh</h4>
                    <div class="prose prose-stone prose-sm max-w-none [&_.ql-editor]:text-sm [&_.ql-editor]:leading-relaxed [&_.ql-editor]:text-stone-700">
                      <div class="ql-container">
                        <div class="ql-editor">${t.example||'<p class="text-stone-400 italic">Tidak ada contoh</p>'}</div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="mt-4 pt-4 border-t border-stone-100 flex justify-end gap-2">
                  <button class="edit-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-md" data-id="${t.id}">
                    Edit
                  </button>
                  <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md" data-id="${t.id}">
                    Hapus
                  </button>
                </div>
              </div>
            </div>
          `})}catch(a){listContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat data.</p>'}})}form.addEventListener("submit",a=>l(null,null,function*(){a.preventDefault();const e=form.pattern.value,t=quillExplanation.root.innerHTML,n=quillExample.root.innerHTML,i=editingIdInput.value,o=!!i,m=imageUrlContainer.querySelectorAll('input[type="url"]'),d=Array.from(m).map(s=>s.value.trim()).filter(s=>s.length>0);if(!e){showToast("Pola kalimat tidak boleh kosong!","warning");return}if(t==="<p><br></p>"&&n==="<p><br></p>"){showToast("Penjelasan atau Contoh tidak boleh kosong!","warning");return}const r={pattern:e,explanation:t,example:n,image_urls:d};o||(r.bab_id=babId);const c=o?`/api/grammar/${i}`:"/api/grammar",u=o?"PUT":"POST";try{if(!(yield fetch(c,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error(o?"Gagal memperbarui":"Gagal menyimpan");resetForm(),fetchGrammar(),showToast(o?"Pola kalimat berhasil diperbarui.":"Pola kalimat berhasil disimpan.")}catch(s){showToast(s.message,"error")}})),listContainer.addEventListener("click",a=>{if(a.target.closest(".drag-handle"))return;const e=a.target.closest("button");if(!e)return;const t=e.dataset.id;e.classList.contains("delete-btn")?deleteGrammar(t):e.classList.contains("edit-btn")&&editGrammar(t)});function deleteGrammar(a){Swal.fire({title:"Anda yakin?",text:"Pola kalimat ini akan dihapus permanen.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",cancelButtonText:"Batal",confirmButtonText:"Ya, hapus!"}).then(e=>l(null,null,function*(){if(e.isConfirmed)try{if(!(yield fetch(`/api/grammar/${a}`,{method:"DELETE"})).ok)throw new Error("Gagal menghapus");fetchGrammar(),showToast("Pola kalimat berhasil dihapus."),resetForm()}catch(t){showToast(t.message,"error")}}))}function editGrammar(a){return l(this,null,function*(){try{const e=yield fetch(`/api/grammar/entry/${a}`);if(!e.ok)throw new Error("Gagal mengambil data");const t=yield e.json();form.pattern.value=t.pattern,quillExplanation.root.innerHTML=t.explanation,quillExample.root.innerHTML=t.example,editingIdInput.value=t.id,imageUrlContainer.innerHTML="",t.image_urls&&t.image_urls.length>0&&t.image_urls.forEach(n=>{addImageInput(n)}),formTitle.textContent="Edit Pola Kalimat",submitButton.textContent="Simpan Perubahan",cancelEditButton.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),form.pattern.focus()}catch(e){showToast(e.message,"error")}})}function resetForm(){form.reset(),quillExplanation.root.innerHTML="",quillExample.root.innerHTML="",editingIdInput.value="",imageUrlContainer.innerHTML="",formTitle.textContent="Tambah Pola Kalimat Baru",submitButton.textContent="Simpan Pola Kalimat",cancelEditButton.classList.add("hidden")}cancelEditButton.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",()=>{fetchGrammar(),new Sortable(listContainer,{animation:150,ghostClass:"sortable-ghost",handle:".drag-handle",onEnd:a=>l(null,null,function*(){const e=listContainer.querySelectorAll(".grammar-item"),t=Array.from(e).map(n=>n.dataset.id);try{const n=yield fetch("/api/grammar/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({babId,orderedIds:t})});if(!n.ok)throw new Error("Gagal menyimpan urutan");if((yield n.json()).success)showToast("Urutan berhasil diperbarui.");else throw new Error("Gagal menyimpan urutan")}catch(n){showToast(n.message,"error"),fetchGrammar()}})})});</script></body></html>