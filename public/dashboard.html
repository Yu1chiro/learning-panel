<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin Dashboard</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script></head><body class="bg-stone-50 antialiased"><nav class="bg-white border-b border-stone-200 backdrop-blur-sm bg-white/90 sticky top-0 z-10"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center"><h1 class="text-lg font-semibold text-stone-900 tracking-tight">Admin Dashboard</h1><a href="/api/logout" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Logout</a></div></nav><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-5xl"><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8 mb-8"><h2 id="form-title" class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Tambah Bab Baru</h2><form id="add-chapter-form" class="space-y-5"><input type="hidden" id="editingId" value=""><div><label for="title" class="block text-sm font-medium text-stone-700 mb-2">Judul Bab</label> <input type="text" id="title" name="title" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400" placeholder="Masukkan judul bab" required></div><div><label for="description" class="block text-sm font-medium text-stone-700 mb-2">Deskripsi Singkat</label> <textarea id="description" name="description" rows="3" class="w-full px-4 py-2.5 text-sm text-stone-900 bg-white border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 focus:border-transparent transition-all duration-200 placeholder:text-stone-400 resize-none" placeholder="Tambahkan deskripsi (opsional)"></textarea></div><div class="flex items-center gap-3"><button type="submit" id="submit-button" class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Tambah Bab</button> <button type="button" id="cancel-edit-button" class="hidden inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 focus:ring-offset-2">Batal Edit</button></div></form></div><div class="bg-white rounded-xl border border-stone-200 shadow-sm p-6 sm:p-8"><h2 class="text-xl font-semibold text-stone-900 mb-6 tracking-tight">Kelola Materi</h2><div id="chapters-list" class="space-y-3"><p class="text-sm text-stone-500">Memuat daftar bab...</p></div></div></main><script>var r=(e,t,n)=>new Promise((o,i)=>{var c=a=>{try{s(n.next(a))}catch(l){i(l)}},d=a=>{try{s(n.throw(a))}catch(l){i(l)}},s=a=>a.done?o(a.value):Promise.resolve(a.value).then(c,d);s((n=n.apply(e,t)).next())});const form=document.getElementById("add-chapter-form"),listContainer=document.getElementById("chapters-list"),formTitle=document.getElementById("form-title"),submitButton=document.getElementById("submit-button"),cancelEditButton=document.getElementById("cancel-edit-button"),editingIdInput=document.getElementById("editingId"),CACHE_KEY="chaptersCache";function getCachedChapters(){const e=sessionStorage.getItem(CACHE_KEY);return e?JSON.parse(e):null}function setCachedChapters(e){sessionStorage.setItem(CACHE_KEY,JSON.stringify(e))}function clearCache(){sessionStorage.removeItem(CACHE_KEY)}const showToast=(e,t="success")=>{Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})};function fetchChapters(){return r(this,null,function*(){const e=getCachedChapters();if(e){console.log("Data bab dimuat dari cache..."),renderChapters(e);return}try{console.log("Data bab di-fetch dari server...");const n=yield(yield fetch("/api/chapters")).json();setCachedChapters(n),renderChapters(n)}catch(t){listContainer.innerHTML='<p class="text-sm text-red-600">Gagal memuat bab.</p>'}})}function renderChapters(e){if(listContainer.innerHTML="",e.length===0){listContainer.innerHTML='<p class="text-sm text-stone-500">Belum ada bab dibuat.</p>';return}e.forEach(t=>{const n=t.description?t.description.replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",o=t.title.replace(/"/g,"&quot;").replace(/'/g,"&#39;");listContainer.innerHTML+=`
          <div class="border border-stone-200 rounded-lg p-4 sm:p-5 hover:border-stone-300 transition-colors duration-200">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
              <div class="flex-1 min-w-0">
                <h3 class="text-base font-semibold text-stone-900 mb-1 tracking-tight">${t.title}</h3>
                <p class="text-sm text-stone-600 leading-relaxed">${t.description||"Tidak ada deskripsi"}</p>
              </div>
              <div class="flex flex-wrap gap-2">
                <a href="/panel-kosakata?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u270F\uFE0F Kosakata
                </a>
                <a href="/panel-polakalimat?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F9E9} Pola
                </a>
                <a href="/panel-dokkai?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F4D6} Dokkai
                </a>
                
                <a href="/panel-choukai?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F3A7} Choukai
                </a>
                
                <a href="/create-quiz?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 bg-stone-100 hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u2753 Kuis
                </a>
                <button class="edit-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-stone-900 hover:bg-stone-800 rounded-md transition-colors duration-200 whitespace-nowrap"
                  data-id="${t.id}" data-title="${o}" data-description="${n}">
                  Edit
                </button>
                <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors duration-200 whitespace-nowrap"
                  data-id="${t.id}">
                  Hapus
                </button>
              </div>
            </div>
          </div>
        `})}form.addEventListener("submit",e=>r(null,null,function*(){e.preventDefault();const t=form.title.value,n=form.description.value,o=editingIdInput.value,i=!!o,c=i?"PUT":"POST",d=i?`/api/chapters/${o}`:"/api/chapters";try{if(!(yield fetch(d,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,description:n})})).ok)throw new Error(i?"Gagal memperbarui bab":"Gagal menambah bab");clearCache(),resetForm(),fetchChapters(),showToast(i?"Bab berhasil diperbarui!":"Bab berhasil ditambahkan!")}catch(s){showToast(s.message,"error")}})),listContainer.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const n=t.dataset.id;if(t.classList.contains("delete-btn"))deleteChapter(n);else if(t.classList.contains("edit-btn")){const o=t.dataset.title,i=t.dataset.description;editChapter(n,o,i)}});function deleteChapter(e){Swal.fire({title:"Anda yakin?",text:"Bab ini dan SEMUA materi (kosakata, pola, kuis, dokkai, choukai) di dalamnya akan dihapus!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal"}).then(t=>r(null,null,function*(){if(t.isConfirmed)try{if(!(yield fetch(`/api/chapters/${e}`,{method:"DELETE"})).ok)throw new Error("Gagal menghapus");clearCache(),fetchChapters(),showToast("Bab berhasil dihapus."),resetForm()}catch(n){showToast(n.message,"error")}}))}function editChapter(e,t,n){form.title.value=t,form.description.value=n,editingIdInput.value=e,formTitle.textContent="Edit Bab",submitButton.textContent="Simpan Perubahan",cancelEditButton.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),form.title.focus()}function resetForm(){form.reset(),editingIdInput.value="",formTitle.textContent="Tambah Bab Baru",submitButton.textContent="Tambah Bab",cancelEditButton.classList.add("hidden")}cancelEditButton.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",fetchChapters);</script></body></html>