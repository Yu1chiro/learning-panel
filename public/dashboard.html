<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin Dashboard</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script>const THEME_KEY="theme-preference",htmlEl=document.documentElement,applyTheme=e=>{e==="dark"?htmlEl.classList.add("dark"):htmlEl.classList.remove("dark"),localStorage.setItem(THEME_KEY,e)},getPreferredTheme=()=>{const e=localStorage.getItem(THEME_KEY);return e||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")};applyTheme(getPreferredTheme());</script><script>tailwind.config={darkMode:"class",theme:{extend:{colors:{stone:{850:"#1f1c1a",950:"#0c0a09"}}}}};</script><style>:root{--bg-color:#f5f5f4;--text-primary:#1c1917}.dark{--bg-color:#1c1917;--text-primary:#f5f5f4}body{background-color:var(--bg-color);color:var(--text-primary);transition:background-color .3s ease,color .3s ease}.transition-colors{transition-property:background-color,border-color,color,fill,stroke;transition-timing-function:cubic-bezier(0.4,0,0.2,1);transition-duration:.3s}</style></head><body class="antialiased min-h-screen"><nav class="bg-white dark:bg-stone-900 border-b border-stone-200 dark:border-stone-700 backdrop-blur-sm bg-white/90 dark:bg-stone-900/90 sticky top-0 z-10 transition-colors"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center"><h1 class="text-lg font-semibold text-stone-900 dark:text-stone-100 tracking-tight">Admin Dashboard</h1><div class="flex items-center gap-4"><button id="theme-toggle-btn" class="w-10 h-10 flex items-center justify-center rounded-full text-stone-600 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors focus:outline-none" aria-label="Toggle dark mode"><i id="theme-icon-sun" class="fa-solid fa-sun text-xl"></i> <i id="theme-icon-moon" class="fa-solid fa-moon text-xl hidden"></i></button> <a href="/api/logout" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-stone-900 dark:bg-stone-100 dark:text-stone-900 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-900">Logout</a></div></div></nav><main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-5xl"><div class="bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 shadow-sm p-6 sm:p-8 mb-8 transition-colors"><h2 id="form-title" class="text-xl font-semibold text-stone-900 dark:text-stone-100 mb-6 tracking-tight">Tambah Bab Baru</h2><form id="add-chapter-form" class="space-y-5"><input type="hidden" id="editingId" value=""><div><label for="title" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Judul Bab</label> <input type="text" id="title" name="title" class="w-full px-4 py-2.5 text-sm text-stone-900 dark:text-stone-100 bg-white dark:bg-stone-900 border border-stone-300 dark:border-stone-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 focus:border-transparent transition-all duration-200 placeholder:text-stone-400 dark:placeholder:text-stone-500" placeholder="Masukkan judul bab" required></div><div><label for="description" class="block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2">Deskripsi Singkat</label> <textarea id="description" name="description" rows="3" class="w-full px-4 py-2.5 text-sm text-stone-900 dark:text-stone-100 bg-white dark:bg-stone-900 border border-stone-300 dark:border-stone-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 focus:border-transparent transition-all duration-200 placeholder:text-stone-400 dark:placeholder:text-stone-500 resize-none" placeholder="Tambahkan deskripsi (opsional)"></textarea></div><div class="flex items-center gap-3"><button type="submit" id="submit-button" class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-white bg-stone-900 dark:bg-stone-100 dark:text-stone-900 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-100 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Tambah Bab</button> <button type="button" id="cancel-edit-button" class="hidden inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-stone-900 dark:focus:ring-stone-400 focus:ring-offset-2 dark:focus:ring-offset-stone-800">Batal Edit</button></div></form></div><div class="bg-white dark:bg-stone-800 rounded-xl border border-stone-200 dark:border-stone-700 shadow-sm p-6 sm:p-8 transition-colors"><h2 class="text-xl font-semibold text-stone-900 dark:text-stone-100 mb-6 tracking-tight">Kelola Materi</h2><div id="chapters-list" class="space-y-3"><p class="text-sm text-stone-500 dark:text-stone-400">Memuat daftar bab...</p></div></div></main><script>var r=(e,t,n)=>new Promise((s,o)=>{var d=a=>{try{i(n.next(a))}catch(l){o(l)}},c=a=>{try{i(n.throw(a))}catch(l){o(l)}},i=a=>a.done?s(a.value):Promise.resolve(a.value).then(d,c);i((n=n.apply(e,t)).next())});const form=document.getElementById("add-chapter-form"),listContainer=document.getElementById("chapters-list"),formTitle=document.getElementById("form-title"),submitButton=document.getElementById("submit-button"),cancelEditButton=document.getElementById("cancel-edit-button"),editingIdInput=document.getElementById("editingId"),toggleBtn=document.getElementById("theme-toggle-btn"),sunIcon=document.getElementById("theme-icon-sun"),moonIcon=document.getElementById("theme-icon-moon");htmlEl.classList.contains("dark")?(sunIcon.classList.add("hidden"),moonIcon.classList.remove("hidden")):(sunIcon.classList.remove("hidden"),moonIcon.classList.add("hidden")),toggleBtn.addEventListener("click",()=>{const e=htmlEl.classList.contains("dark"),t=e?"light":"dark",n=e?moonIcon:sunIcon,s=e?sunIcon:moonIcon,o=gsap.timeline();o.to(n,{duration:.3,opacity:0,rotation:180,scale:.5,ease:"power2.in",onComplete:()=>{n.classList.add("hidden"),s.classList.remove("hidden"),applyTheme(t)}}),o.from(s,{duration:.3,opacity:0,rotation:-180,scale:.5,ease:"power2.out"})});const CACHE_KEY="chaptersCache";function getCachedChapters(){const e=sessionStorage.getItem(CACHE_KEY);return e?JSON.parse(e):null}function setCachedChapters(e){sessionStorage.setItem(CACHE_KEY,JSON.stringify(e))}function clearCache(){sessionStorage.removeItem(CACHE_KEY)}const showToast=(e,t="success")=>{Swal.fire({toast:!0,position:"top-end",icon:t,title:e,showConfirmButton:!1,timer:3e3,timerProgressBar:!0,background:htmlEl.classList.contains("dark")?"#292524":"#fff",color:htmlEl.classList.contains("dark")?"#f5f5f4":"#545454"})};function fetchChapters(){return r(this,null,function*(){const e=getCachedChapters();if(e){console.log("Data bab dimuat dari cache..."),renderChapters(e);return}try{console.log("Data bab di-fetch dari server...");const n=yield(yield fetch("/api/chapters")).json();setCachedChapters(n),renderChapters(n)}catch(t){listContainer.innerHTML='<p class="text-sm text-red-600 dark:text-red-400">Gagal memuat bab.</p>'}})}function renderChapters(e){if(listContainer.innerHTML="",e.length===0){listContainer.innerHTML='<p class="text-sm text-stone-500 dark:text-stone-400">Belum ada bab dibuat.</p>';return}e.forEach(t=>{const n=t.description?t.description.replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",s=t.title.replace(/"/g,"&quot;").replace(/'/g,"&#39;");listContainer.innerHTML+=`
          <div class="border border-stone-200 dark:border-stone-700 rounded-lg p-4 sm:p-5 hover:border-stone-300 dark:hover:border-stone-600 transition-colors duration-200">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
              <div class="flex-1 min-w-0">
                <h3 class="text-base font-semibold text-stone-900 dark:text-stone-100 mb-1 tracking-tight">${t.title}</h3>
                <p class="text-sm text-stone-600 dark:text-stone-400 leading-relaxed">${t.description||"Tidak ada deskripsi"}</p>
              </div>
              <div class="flex flex-wrap gap-2">
                <a href="/panel-kosakata?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u270F\uFE0F Kosakata
                </a>
                <a href="/panel-polakalimat?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F9E9} Pola
                </a>
                <a href="/panel-dokkai?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F4D6} Dokkai
                </a>
                
                <a href="/panel-choukai?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u{1F3A7} Choukai
                </a>
                
                <a href="/create-quiz?babId=${t.id}&title=${encodeURIComponent(t.title)}" class="inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-stone-700 dark:text-stone-300 bg-stone-100 dark:bg-stone-700 hover:bg-stone-200 dark:hover:bg-stone-600 rounded-md transition-colors duration-200 whitespace-nowrap">
                  \u2753 Kuis
                </a>
                <button class="edit-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white dark:text-stone-900 bg-stone-900 dark:bg-stone-100 hover:bg-stone-800 dark:hover:bg-stone-200 rounded-md transition-colors duration-200 whitespace-nowrap"
                  data-id="${t.id}" data-title="${s}" data-description="${n}">
                  Edit
                </button>
                <button class="delete-btn inline-flex items-center justify-center px-3 py-2 text-xs font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors duration-200 whitespace-nowrap"
                  data-id="${t.id}">
                  Hapus
                </button>
              </div>
            </div>
          </div>
        `})}form.addEventListener("submit",e=>r(null,null,function*(){e.preventDefault();const t=form.title.value,n=form.description.value,s=editingIdInput.value,o=!!s,d=o?"PUT":"POST",c=o?`/api/chapters/${s}`:"/api/chapters";try{if(!(yield fetch(c,{method:d,headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t,description:n})})).ok)throw new Error(o?"Gagal memperbarui bab":"Gagal menambah bab");clearCache(),resetForm(),fetchChapters(),showToast(o?"Bab berhasil diperbarui!":"Bab berhasil ditambahkan!")}catch(i){showToast(i.message,"error")}})),listContainer.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const n=t.dataset.id;if(t.classList.contains("delete-btn"))deleteChapter(n);else if(t.classList.contains("edit-btn")){const s=t.dataset.title,o=t.dataset.description;editChapter(n,s,o)}});function deleteChapter(e){Swal.fire({title:"Anda yakin?",text:"Bab ini dan SEMUA materi di dalamnya akan dihapus!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus!",cancelButtonText:"Batal",background:htmlEl.classList.contains("dark")?"#292524":"#fff",color:htmlEl.classList.contains("dark")?"#f5f5f4":"#545454"}).then(t=>r(null,null,function*(){if(t.isConfirmed)try{if(!(yield fetch(`/api/chapters/${e}`,{method:"DELETE"})).ok)throw new Error("Gagal menghapus");clearCache(),fetchChapters(),showToast("Bab berhasil dihapus."),resetForm()}catch(n){showToast(n.message,"error")}}))}function editChapter(e,t,n){form.title.value=t,form.description.value=n,editingIdInput.value=e,formTitle.textContent="Edit Bab",submitButton.textContent="Simpan Perubahan",cancelEditButton.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),form.title.focus()}function resetForm(){form.reset(),editingIdInput.value="",formTitle.textContent="Tambah Bab Baru",submitButton.textContent="Tambah Bab",cancelEditButton.classList.add("hidden")}cancelEditButton.addEventListener("click",resetForm),document.addEventListener("DOMContentLoaded",fetchChapters);</script></body></html>